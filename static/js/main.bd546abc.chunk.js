(this.webpackJsonpwebgal=this.webpackJsonpwebgal||[]).push([[0],{30:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(2),i=n.n(c),s=(n(30),n(18),n(4)),l=n(5),r=n(10),u=n(9),d=n(0);function m(e){var t="./game/figure/"+ne[e].fig_Name_left,n="./game/figure/"+ne[e].fig_Name,a="./game/figure/"+ne[e].fig_Name_right,o=[];if("none"!==ne[e].fig_Name_left&&""!==ne[e].fig_Name_left){var c=Object(d.jsx)("span",{className:"mini_fig mini_fig_left",children:Object(d.jsx)("img",{src:t,alt:"mini_fig",className:"mini_fig_pic"})});o.push(c)}if("none"!==ne[e].fig_Name&&""!==ne[e].fig_Name){var i=Object(d.jsx)("span",{className:"mini_fig mini_fig_center",children:Object(d.jsx)("img",{src:n,alt:"mini_fig",className:"mini_fig_pic"})});o.push(i)}if("none"!==ne[e].fig_Name_right&&""!==ne[e].fig_Name_right){var s=Object(d.jsx)("span",{className:"mini_fig mini_fig_right",children:Object(d.jsx)("img",{src:a,alt:"mini_fig",className:"mini_fig_pic"})});o.push(s)}return Object(d.jsx)("div",{id:"ren_SE"+e,className:"miniPic",children:o})}var g=function(e){Object(r.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={buttonState:["","",""]},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=["","",""],t=se.font_size;e[Object.keys($.font_size).indexOf(t)]="On",this.setState({buttonState:e})}},{key:"componentWillUnmount",value:function(){}},{key:"changeButtonState",value:function(e){var t=Object.keys($.font_size)[e],n=$.font_size[t],a=["","",""];document.getElementById("SceneText").style.fontSize=n,document.getElementById("previewDiv").style.fontSize=n,a[e]="On",de(),this.setState({buttonState:a})}},{key:"render",value:function(){var e=this;return Object(d.jsxs)("div",{className:"singleSettingItem",children:[Object(d.jsx)("span",{className:"settingItemTitle",children:"\u5b57\u4f53\u5927\u5c0f"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[0],onClick:function(){e.changeButtonState(0)},children:"\u5c0f"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[1],onClick:function(){e.changeButtonState(1)},children:"\u4e2d"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[2],onClick:function(){e.changeButtonState(2)},children:"\u5927"})]})}}]),n}(o.a.Component),v=function(e){Object(r.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={buttonState:["","",""]},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=["","",""],t=se.play_speed;e[Object.keys($.play_speed).indexOf(t)]="On",this.setState({buttonState:e})}},{key:"componentWillUnmount",value:function(){}},{key:"changeButtonState",value:function(e){var t=Object.keys($.play_speed)[e],n=$.play_speed[t],a=["","",""];re().textShowWaitTime=n,a[e]="On",de(),this.setState({buttonState:a})}},{key:"render",value:function(){var e=this;return Object(d.jsxs)("div",{className:"singleSettingItem",children:[Object(d.jsx)("span",{className:"settingItemTitle",children:"\u64ad\u653e\u901f\u5ea6"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[0],onClick:function(){e.changeButtonState(0)},children:"\u6162"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[1],onClick:function(){e.changeButtonState(1)},children:"\u4e2d"}),Object(d.jsx)("span",{className:"settingItemButton"+this.state.buttonState[2],onClick:function(){e.changeButtonState(2)},children:"\u5feb"})]})}}]),n}(o.a.Component),f=function(e){Object(r.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).Buttons=[],a.SaveButtons=[],a.LoadPageQty=0,a.LoadPageQty=e.PageQty,a.state={currentPage:re().currentLoadPage},a.loadButtons(),a}return Object(l.a)(n,[{key:"setCurrentPage",value:function(e){re().currentLoadPage=e,this.setState({currentPage:re().currentLoadPage}),de()}},{key:"loadButtons",value:function(){var e=this;this.Buttons=[];for(var t=function(t){var n=Object(d.jsx)("span",{className:"LoadIndexButton LS_indexButton",onClick:function(){e.setCurrentPage(t)},children:t+1},t);t===re().currentLoadPage&&(n=Object(d.jsx)("span",{className:"LoadIndexButtonOn LS_indexButtonOn",onClick:function(){e.setCurrentPage(t)},children:t+1},t)),e.Buttons.push(n)},n=0;n<this.LoadPageQty;n++)t(n)}},{key:"loadSaveButtons",value:function(){var e=this;this.SaveButtons=[];for(var t=function(t){if(ne[t]){var n=ne[t].showName,a=ne[t].showText,o=m(t),c="game/background/"+ne[t].bg_Name,i=Object(d.jsxs)("div",{className:"LoadSingleElement LS_singleElement",onClick:function(){je.LoadSavedGame(t)},children:[Object(d.jsxs)("div",{className:"LS_Title",children:[Object(d.jsx)("span",{className:"LS_Title_index",children:t}),Object(d.jsx)("span",{className:"LS_Title_time",children:ne[t].saveTime})]}),Object(d.jsxs)("div",{className:"LS_infoArea",children:[Object(d.jsx)("div",{className:"ren",style:{backgroundImage:"url(".concat(c,")")},children:o},t),Object(d.jsxs)("div",{className:"LS_textArea",children:[Object(d.jsx)("div",{className:"LSE_top",children:Object(d.jsx)("span",{className:"L_name",children:n})}),Object(d.jsx)("div",{className:"LSE_bottom",children:a})]})]})]},t);e.SaveButtons.push(i)}else{var s=Object(d.jsx)("div",{className:"LoadSingleElement LS_singleElement"},t);e.SaveButtons.push(s)}},n=6*re().currentLoadPage+1;n<=6*re().currentLoadPage+6;n++)t(n)}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return this.loadButtons(),this.loadSaveButtons(),Object(d.jsxs)("div",{id:"LoadMain",className:"LS_renderMain",children:[Object(d.jsxs)("div",{className:"LS_Title_and_Button",children:[Object(d.jsx)("div",{id:"LoadTitle",children:"\u8bfb\u6863"}),Object(d.jsx)("div",{id:"LoadIndex",className:"LS_Index",children:this.Buttons})]}),Object(d.jsx)("div",{id:"LoadButtonList",className:"LS_ButtonList",children:this.SaveButtons})]})}}]),n}(o.a.Component),h=function(e){Object(r.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).Buttons=[],a.SaveButtons=[],a.LoadPageQty=0,a.ren_bg_list=[],a.LoadPageQty=e.PageQty,a.state={currentPage:re().currentSavePage},a.loadButtons(),a}return Object(l.a)(n,[{key:"setCurrentPage",value:function(e){re().currentSavePage=e,this.setState({currentPage:re().currentSavePage}),de()}},{key:"loadButtons",value:function(){var e=this;this.Buttons=[];for(var t=function(t){var n=Object(d.jsx)("span",{className:"SaveIndexButton LS_indexButton",onClick:function(){e.setCurrentPage(t)},children:t+1},t);t===re().currentSavePage&&(n=Object(d.jsx)("span",{className:"SaveIndexButtonOn LS_indexButtonOn",onClick:function(){e.setCurrentPage(t)},children:t+1},t)),e.Buttons.push(n)},n=0;n<this.LoadPageQty;n++)t(n)}},{key:"loadSaveButtons",value:function(){var e=this;this.SaveButtons=[],this.ren_bg_list=[];for(var t=function(t){if(ne[t]){var n=ne[t].showName,a=ne[t].showText,o=m(t),c="game/background/"+ne[t].bg_Name,i=Object(d.jsxs)("div",{className:"SaveSingleElement LS_singleElement",onClick:function(){e.save_onSaved(t)},children:[Object(d.jsxs)("div",{className:"LS_Title",children:[Object(d.jsx)("span",{className:"LS_Title_index S_Title_index",children:t}),Object(d.jsx)("span",{className:"LS_Title_time S_Title_time",children:ne[t].saveTime})]}),Object(d.jsxs)("div",{className:"LS_infoArea",children:[Object(d.jsx)("div",{className:"ren",style:{backgroundImage:"url(".concat(c,")")},children:o},t),Object(d.jsxs)("div",{className:"LS_textArea",children:[Object(d.jsxs)("div",{className:"LSE_top",children:[Object(d.jsx)("span",{className:"LSE_index",children:t}),Object(d.jsx)("span",{className:"LSE_name",children:n})]}),Object(d.jsx)("div",{className:"LSE_bottom",children:a})]})]})]},t);e.SaveButtons.push(i)}else{var s=Object(d.jsx)("div",{className:"SaveSingleElement LS_singleElement",onClick:function(){e.save_NonSaved(t)}},t);e.SaveButtons.push(s)}},n=6*re().currentSavePage+1;n<=6*re().currentSavePage+6;n++)t(n)}},{key:"save_NonSaved",value:function(e){je.saveGame(e),de(),this.setState({currentPage:re().currentSavePage})}},{key:"save_onSaved",value:function(e){D.showMesModel("\u4f60\u8981\u8986\u76d6\u8fd9\u4e2a\u5b58\u6863\u5417","\u8986\u76d6","\u4e0d",(function(){je.saveGame(e),de(),je.closeSave()})),this.setState({currentPage:re().currentSavePage})}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return this.loadButtons(),this.loadSaveButtons(),Object(d.jsxs)("div",{id:"SaveMain",className:"LS_renderMain",children:[Object(d.jsxs)("div",{className:"LS_Title_and_Button",children:[Object(d.jsx)("div",{id:"SaveTitle",children:"\u5b58\u6863"}),Object(d.jsx)("div",{id:"SaveIndex",className:"LS_Index",children:this.Buttons})]}),Object(d.jsx)("div",{id:"SaveButtonList",className:"LS_ButtonList",children:this.SaveButtons})]})}}]),n}(o.a.Component);var j=function(e){Object(r.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(s.a)(this,n),(e=t.call(this)).dummyA=null,e.dummyInput=null,e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.dummyA=document.querySelector("a#dummy-saves-exporter"),this.dummyInput=document.querySelector("input#dummy-saves-importer")}},{key:"importSaves",value:function(e){var t=e.target.files[0],n=new FileReader;n.onload=function(e){var t=e.target.result;localStorage.setItem(Z.Game_key,t),ue(),window.location.reload()},n.readAsText(t,"UTF-8")}},{key:"exportSaves",value:function(){var e=localStorage.getItem(Z.Game_key);if(null===e)return!1;var t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t);return URL.revokeObjectURL(this.dummyA.href),this.dummyA.href=n,this.dummyA.download="saves.json",this.dummyA.click(),!0}},{key:"render",value:function(){var e=this;return Object(d.jsxs)("div",{className:"importer-exporter",children:[Object(d.jsx)("span",{className:"label-saves-exporter",onClick:function(){e.exportSaves()},children:"\u5bfc\u51fa\u5b58\u6863"}),Object(d.jsx)("a",{target:"_blank",id:"dummy-saves-exporter",style:{display:"none"}}),Object(d.jsx)("span",{className:"label-saves-importer",onClick:function(){e.dummyInput.click()},children:"\u5bfc\u5165\u5b58\u6863"}),Object(d.jsx)("input",{type:"file",id:"dummy-saves-importer",style:{display:"none"},onChange:this.importSaves})]})}},{key:"checkSyntax",value:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}}]),n}(o.a.Component),y=function(e){var t,n=e.P_name;if("none"===n||""===n)t=Object(d.jsx)("div",{});else{var a="game/figure/"+n;t=Object(d.jsx)("img",{src:a,alt:"figure",className:"p_center"})}return t},p=function(e){for(var t=[],n=function(n){var a=void 0;"scene"===e.mode?a=Object(d.jsx)("div",{className:"singleChoose",onClick:function(){je.chooseScene(e.selection[n][1])},children:e.selection[n][0]},n):"label"===e.mode&&(a=Object(d.jsx)("div",{className:"singleChoose",onClick:function(){je.chooseJumpFun(e.selection[n][1])},children:e.selection[n][0]},n)),t.push(a)},a=0;a<e.selection.length;a++)n(a);return Object(d.jsx)("div",{children:t})},b=n(13),x=n(7);function S(e){if(e<re().currentScene.length){var t="";if(""!==re().currentScene[e][1]){var n=re().currentScene[e][1];return re().currentScene[e][1].split("vocal-").length>1&&(t=re().currentScene[e][1].split("vocal-")[1].split(",")[0],n=re().currentScene[e][1].split("vocal-")[1].slice(re().currentScene[e][1].split("vocal-")[1].split(",")[0].length+1)),ge("showName",re().currentScene[e][0]),{name:ve("showName"),text:n,vocal:t}}var a=re().currentScene[e][0];return re().currentScene[e][0].split("vocal-").length>1&&(t=re().currentScene[e][0].split("vocal-")[1].split(",")[0],a=(a=re().currentScene[e][0].split("vocal-")[1].slice(re().currentScene[e][0].split("vocal-")[1].split(",")[0].length+1)).split(";")[0]),{name:ve("showName"),text:a,vocal:t}}}function B(e){var t=new Map([["TitleScreen","div#Title"],["TextBox","div#bottomBox"],["SaveScreen","div#Save"],["LoadScreen","div#Load"],["SettingScreen","div#settings"],["BacklogScreen","div#backlog"],["PanicScreen","div#panic-overlay"]]),n=!1;"string"===typeof e?(e=[e],n=!0):void 0===e&&(e=Array.from(t.keys()));var a,o=new Map,c=Object(x.a)(e);try{for(c.s();!(a=c.n()).done;){var i=a.value,s=t.get(i);if(void 0===s)throw new RangeError("No widget named ".concat(i,"."));var l=document.querySelector(s),r=l.style.display;""===r&&(r=window.getComputedStyle(l).display),o.set(i,"none"!==r)}}catch(u){c.e(u)}finally{c.f()}return n&&(o=o.values().next().value),o}function _(e,t){"string"===typeof t?t=[t]:void 0===t&&(t=[]);var n,a=Object(x.a)(e);try{for(a.s();!(n=a.n()).done;){var o=Object(b.a)(n.value,2),c=o[0];if(!0===o[1]&&!t.includes(c))return!1}}catch(i){a.e(i)}finally{a.f()}return!0}function O(e){for(var t=(e=(e=e.split("}")[0]).split("{")[1]).split(","),n=0;n<t.length;n++)t[n]=t[n].split(":");return t}var k=function(e){var t=e.command;if(D.VC_textShow(e.showName,e.showText),""!==e.bg_transform&&(document.getElementById("mainBackground").style.transform=e.bg_transform),""!==e.bg_filter&&(document.getElementById("mainBackground").style.filter=e.bg_filter),""!==e.bg_Name&&(document.getElementById("mainBackground").style.backgroundImage="url('game/background/"+e.bg_Name+"')"),D.VC_changeP(e.fig_Name_left,"left"),D.VC_changeP(e.fig_Name,"center"),D.VC_changeP(e.fig_Name_right,"right"),"choose"===t||"choose_label"===t){var n=O(e.choose),a="choose"===t?"scene":"label";D.VC_choose(n,a)}D.VC_showMiniAvatar(e.miniAvatar),ve("bgm")!==e.bgm&&(re().currentInfo.bgm=e.bgm,D.loadBGM()),ge("vocal",e.vocal),D.playVocal()},I=function(){return Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"settingsItemsList",children:[Object(d.jsx)(g,{}),Object(d.jsx)(v,{}),Object(d.jsx)("div",{className:"deleteCookie",onClick:function(){D.showMesModel("\u4f60\u786e\u5b9a\u8981\u6e05\u9664\u7f13\u5b58\u5417","\u8981","\u4e0d\u8981",me)},children:"\u6e05\u9664\u6240\u6709\u8bbe\u7f6e\u9009\u9879\u4ee5\u53ca\u5b58\u6863"}),Object(d.jsx)(j,{}),Object(d.jsxs)("div",{children:["\u672c\u4f5c\u54c1\u7531 WebGAL \u5f3a\u529b\u9a71\u52a8\uff0c",Object(d.jsx)("a",{href:"https://github.com/MakinoharaShoko/WebGAL",children:"\u4e86\u89e3 WebGAL"}),"\u3002"]}),Object(d.jsx)("br",{}),Object(d.jsx)("div",{className:"settingItemTitle",children:"\u6548\u679c\u9884\u89c8"})]})})},N=function(e){var t=document.getElementById("mainBackground"),n=t.cloneNode(!0);document.getElementById("oldBG")&&document.getElementById("oldBG").parentNode.removeChild(document.getElementById("oldBG")),n.setAttribute("id","oldBG"),n.style.animation="hideBG 5s",n.style.animationFillMode="forwards",console.log(n),t.parentNode.appendChild(n),t.style.backgroundImage="url('game/background/"+e+"')";var a=t.cloneNode(!0),o=t.parentNode;o.removeChild(t),o.appendChild(a)},C=function(){console.log("loadingBGM");var e=re().currentInfo.bgm;if(console.log("now playing "+e),""===e||"none"===e)return console.log("set bgm none"),document.getElementById("currentBGM")&&(document.getElementById("currentBGM").autoplay=!1,document.getElementById("currentBGM").pause()),void i.a.render(Object(d.jsx)("div",{}),document.getElementById("bgm"));var t="./game/bgm/"+e,n=Object(d.jsx)("audio",{src:t,id:"currentBGM",loop:"loop"});i.a.render(n,document.getElementById("bgm"),(function(){var e=document.getElementById("currentBGM"),t=!1;console.log(e),e.oncanplay=function(){!1===t&&(e.currentTime=0,e.volume=.25,t=!0,e.play())},!1===t&&document.getElementById("currentBGM")&&(e.currentTime=0,e.volume=.25,t=!0,e.play())}))},w=n(49),T=n(50),E=function(e){for(var t=[],n=function(e){var n=Object(d.jsxs)("div",{className:"backlog_singleElement",style:{opacity:0,animationFillMode:"forwards",animationDelay:.07*(re().CurrentBacklog.length-e)+"s"},children:[Object(d.jsxs)("div",{className:"backlog_interact",children:[Object(d.jsx)("div",{className:"backlog_interact_button",onClick:function(){var t=re().CurrentBacklog[e].vocal;if(""!==t){var n="./game/vocal/"+t,a=Object(d.jsx)("audio",{src:n,id:"backlogVocalAudio-"+e});console.log("Playing! now url is"+n),i.a.render(a,document.getElementById("backlogVocal-"+e));var o=document.getElementById("backlogVocalAudio-"+e),c=!1;c=!1,o.oncanplay=function(){c||(o.currentTime=0,c=!0,o.play()),o.play()},c||(o.currentTime=0,c=!0,o.play())}},children:Object(d.jsx)(w.a,{theme:"outline",size:"24",fill:"#f5f5f7"})}),Object(d.jsx)("div",{className:"backlog_interact_button",onClick:function(){je.jumpFromBacklog(e)},children:Object(d.jsx)(T.a,{theme:"outline",size:"24",fill:"#f5f5f7"})})]}),Object(d.jsx)("div",{className:"backlog_name",children:re().CurrentBacklog[e].showName}),Object(d.jsx)("div",{className:"backlog_content",children:Object(d.jsx)("div",{className:"backlog_text",children:re().CurrentBacklog[e].showText})}),Object(d.jsx)("div",{id:"backlogVocal-"+e})]},e);t.push(n)},a=0;a<re().CurrentBacklog.length;a++)n(a);return Object(d.jsx)("div",{children:t})},L=function(){return Object(d.jsxs)("div",{className:"yoozle-container",children:[Object(d.jsx)("div",{className:"yoozle-title",children:Object(d.jsxs)("span",{children:[Object(d.jsx)("span",{className:"yoozle-gl-blue",children:"Y"}),Object(d.jsx)("span",{className:"yoozle-gl-red",children:"o"}),Object(d.jsx)("span",{className:"yoozle-gl-yellow",children:"o"}),Object(d.jsx)("span",{className:"yoozle-gl-blue",children:"z"}),Object(d.jsx)("span",{className:"yoozle-gl-green",children:"l"}),Object(d.jsx)("span",{className:"yoozle-gl-red yoozle-e-rotate",children:"e"})]})}),Object(d.jsxs)("div",{className:"yoozle-search",children:[Object(d.jsx)("input",{className:"yoozle-search-bar",type:"text",defaultValue:""}),Object(d.jsxs)("div",{className:"yoozle-search-buttons",children:[Object(d.jsx)("input",{className:"yoozle-btn",type:"submit",value:"Yoozle Search"}),Object(d.jsx)("input",{className:"yoozle-btn",type:"submit",value:"I'm Feeling Lucky"})]})]})]})},P=function(e){re().onTextPreview=re().onTextPreview+1;var t=e.split("");i.a.render(Object(d.jsx)("span",{children:" "}),document.getElementById("previewDiv"));var n=[],a=0;clearInterval(o);var o=setInterval((function e(){if(re().onTextPreview>1)return re().onTextPreview=re().onTextPreview-1,void clearInterval(o);var c=Object(d.jsx)("span",{className:"singleWord",children:t[a]},a);n.push(c),i.a.render(Object(d.jsx)("div",{children:n}),document.getElementById("previewDiv")),(a+=1)>t.length+1e3/35&&(clearInterval(o),o=setInterval(e,re().textShowWaitTime),a=0,n=[])}),re().textShowWaitTime)},G=function(e){re().showingText=!1,i.a.render(Object(d.jsx)("span",{children:" "}),document.getElementById("SceneText"));var t=[],n=0;clearInterval(a);var a=setInterval((function(){if(re().showingText){var o=Object(d.jsx)("span",{className:"singleWord",children:e[n]},n);t.push(o),i.a.render(Object(d.jsx)("div",{children:t}),document.getElementById("SceneText")),n+=1}else{for(var c="",s=0;s<e.length;s++)c+=e[s];i.a.render(Object(d.jsx)("div",{children:c}),document.getElementById("SceneText")),1===re().auto?n<e.length+1?n=e.length+1:n+=1:n=e.length+1+re().autoWaitTime/35}n>e.length&&1!==re().auto&&(re().showingText=!1);n>e.length+re().autoWaitTime/35&&(1===re().auto?document.getElementById("currentVocal")&&0===re().fast?document.getElementById("currentVocal").ended&&(clearInterval(a),re().showingText=!1,A()):(clearInterval(a),re().showingText=!1,A()):(re().showingText=!1,clearInterval(a)))}),re().textShowWaitTime);re().showingText=!0},V=function(e){var t=e.titleText,n=e.Left,a=e.Right,o=e.func;return Object(d.jsxs)("div",{className:"MesMainWindow",children:[Object(d.jsx)("div",{className:"MesTitle",children:t}),Object(d.jsxs)("div",{className:"MesChooseContainer",children:[Object(d.jsx)("div",{className:"MesChoose",onClick:function(){o(),document.getElementById("MesModel").style.display="none"},children:n}),Object(d.jsx)("div",{className:"MesChoose",onClick:function(){document.getElementById("MesModel").style.display="none"},children:a})]})]})},D=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"VC_changeBG",value:function(e){N(e)}},{key:"VC_changeP",value:function(e,t){var n=Object(d.jsx)(y,{P_name:e});switch(t){case"center":i.a.render(n,document.getElementById("figureImage")),re().currentInfo.fig_Name=e;break;case"left":i.a.render(n,document.getElementById("figureImage_left")),re().currentInfo.fig_Name_left=e;break;case"right":i.a.render(n,document.getElementById("figureImage_right")),re().currentInfo.fig_Name_right=e;break;default:console.log("\u7acb\u7ed8\u4f4d\u7f6e\u53c2\u6570\u9519\u8bef")}}},{key:"VC_choose",value:function(e,t){document.getElementById("chooseBox").style.display="flex";var n=Object(d.jsx)(p,{mode:t,selection:e});i.a.render(n,document.getElementById("chooseBox"))}},{key:"VC_closeChoose",value:function(){document.getElementById("chooseBox").style.display="none"}},{key:"VC_textShow",value:function(t,n){var a=Object(d.jsx)("span",{children:t}),o=n.split("");i.a.render(a,document.getElementById("pName")),e.showTextArray(o)}},{key:"VC_setBGtransform",value:function(e){document.getElementById("mainBackground").style.transform=e}},{key:"VC_setBGfilter",value:function(e){document.getElementById("mainBackground").style.filter=e}},{key:"VC_restoreStatus",value:function(e){k(e)}},{key:"VC_showSettings",value:function(){var t=Object(d.jsx)(I,{});document.getElementById("settings").style.display="flex",document.getElementById("bottomBox").style.display="none",i.a.render(t,document.getElementById("settingItems")),i.a.render(Object(d.jsx)("div",{id:"previewDiv"}),document.getElementById("textPreview")),e.showTextPreview("\u73b0\u5728\u9884\u89c8\u7684\u662f\u6587\u672c\u6846\u5b57\u4f53\u5927\u5c0f\u548c\u64ad\u653e\u901f\u5ea6\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u89c2\u611f\u8c03\u6574\u4e0a\u9762\u7684\u9009\u9879\u3002")}},{key:"VC_showSave_Load",value:function(e){"save"===e?i.a.render(Object(d.jsx)(h,{PageQty:15}),document.getElementById("SaveItems")):i.a.render(Object(d.jsx)(f,{PageQty:15}),document.getElementById("LoadItems"))}},{key:"VC_resetStage",value:function(){i.a.render(Object(d.jsx)("div",{}),document.getElementById("figureImage")),i.a.render(Object(d.jsx)("div",{}),document.getElementById("figureImage_left")),i.a.render(Object(d.jsx)("div",{}),document.getElementById("figureImage_right"))}},{key:"loadBGM",value:function(){C()}},{key:"playVocal",value:function(){console.log("Playing vocal:");var e=ve("all");document.getElementById("currentVocal")&&document.getElementById("currentVocal").pause();var t=e.vocal;if(""!==t){var n="./game/vocal/"+t,a=Object(d.jsx)("audio",{src:n,id:"currentVocal"});i.a.render(a,document.getElementById("vocal"),(function(){var e=document.getElementById("currentVocal");e.currentTime=0,e.oncanplay=function(){e.play()}}))}else i.a.render(Object(d.jsx)("div",{}),document.getElementById("vocal"))}},{key:"showIntro",value:function(e){var t=0,n=Object(d.jsx)("div",{children:Object(d.jsx)("div",{id:"textShowArea",className:"textShowArea_styl"})});i.a.render(n,document.getElementById("intro")),i.a.render(Object(d.jsx)("div",{children:" "}),document.getElementById("textShowArea")),document.getElementById("intro").style.display="block";var a=e.split(","),o=setInterval((function(){var e=Object(d.jsx)("div",{className:"introSingleRow",children:a[t]},t);c.push(e),t+=1,i.a.render(Object(d.jsx)("div",{children:c}),document.getElementById("textShowArea")),t>=a.length&&(clearInterval(o),setTimeout(je.clearIntro,3500))}),1500),c=[]}},{key:"showVideo",value:function(e){var t=Object(d.jsx)("video",{autoPlay:!0,id:"video_show",src:"./game/video/".concat(e)});i.a.render(t,document.getElementById("videoContainer"),(function(){document.getElementById("video_show").onended=function(){i.a.render(Object(d.jsx)("div",{}),document.getElementById("videoContainer")),document.getElementById("videoContainer").style.display="none",A()}})),document.getElementById("videoContainer").style.display="flex"}},{key:"closeVideo",value:function(){i.a.render(Object(d.jsx)("div",{}),document.getElementById("videoContainer")),document.getElementById("videoContainer").style.display="none",A()}},{key:"showBacklog",value:function(){document.getElementById("backlog").style.display="block",document.getElementById("bottomBox").style.display="none",i.a.render(Object(d.jsx)(E,{}),document.getElementById("backlogContent"))}},{key:"showTextArray",value:function(e){G(e)}},{key:"showTextPreview",value:function(e){P(e)}},{key:"showMesModel",value:function(e,t,n,a){document.getElementById("MesModel").style.display="block";var o=Object(d.jsx)(V,{titleText:e,Left:t,Right:n,func:a});i.a.render(o,document.getElementById("MesModel"))}},{key:"VC_showMiniAvatar",value:function(e){if(""!==e&&"none"!==e){var t="game/figure/"+e,n=Object(d.jsx)("img",{src:t,className:"miniAvatar_pic",alt:"miniAvatar"});i.a.render(n,document.getElementById("miniAvatar"))}else i.a.render(Object(d.jsx)("div",{}),document.getElementById("miniAvatar"))}},{key:"VC_setAnimationByClass",value:function(e,t,n){console.log("setting animate by class on: "+e+"set to "+t);for(var a=t+" "+n,o=document.getElementsByClassName(e),c=0;c<o.length;c++)o[c].style.animation="none";setTimeout((function(){for(var e=0;e<o.length;e++)o[e].style.animation=a+" ease"}),1)}},{key:"VC_setAnimationById",value:function(e,t,n){document.getElementById(e).style.animation="none",setTimeout((function(){document.getElementById(e).style.animation=t+" "+n+" ease"}),1)}},{key:"showPanic",value:function(e){if(document.querySelector("div#panic-overlay").style.display="block","Yoozle"===e){var t=Object(d.jsx)(L,{});i.a.render(t,document.querySelector("div#panic-overlay")),document.querySelector("input.yoozle-search-bar").value=""}}}]),e}();function A(){if(re().showingText)re().showingText=!1;else{var e=!1;if(!(ve("SentenceID")>=re().currentScene.length)){var t=re().currentScene[ve("SentenceID")],n=t[0],a=t[1];if(console.log("------now running NSP------"+t),"changeBG"===n)D.VC_changeBG(a),ge("bg_Name",a),v("on");else if("changeP"===n)D.VC_changeP(a,"center"),ge("fig_Name",a),v("on");else if("changeP_left"===n)D.VC_changeP(a,"left"),ge("fig_Name_left",a),v("on");else if("changeP_right"===n)D.VC_changeP(a,"right"),ge("fig_Name_right",a),v("on");else{if("changeP_next"===n)return D.VC_changeP(a,"center"),ge("fig_Name",a),M(),void A();if("changeP_left_next"===n)return D.VC_changeP(a,"left"),ge("fig_Name_left",a),M(),void A();if("changeP_right_next"===n)return D.VC_changeP(a,"right"),ge("fig_Name_right",a),M(),void A();if("changeBG_next"===n)return D.VC_changeBG(a),M(),ge("bg_Name",a),void A();if("changeScene"===n)return fe("game/scene/"+t[1]),void ge("SceneName",a);if("choose"===n){ge("command",n),ge("choose",a);var o=O(a);return void D.VC_choose(o,"scene")}if("bgm"===n)return ge("bgm",a),D.loadBGM(),M(),void A();if("choose_label"===n){ge("command",n),ge("choose",a);var c=O(a);return void D.VC_choose(c,"label")}if("jump_label"===n)return void z(t[1]);if("label"===n)return M(),void A();if("intro"===n){var i=t[1];return void D.showIntro(i)}if("miniAvatar"===n)return D.VC_showMiniAvatar(a),ge("miniAvatar",a),M(),void A();if("var"===n.substring(0,3)||"jump_var"===n.substring(0,8))return void function(e,t){if("varSet"===e){t=t.split(";")[0],console.log(t),t=t.split(","),console.log(t);for(var n=0;n<t.length;n++){var a=t[n];a=a.split(":"),console.log(a),re().currentInfo.GameVar[a[0]]=parseInt(a[1])}}else if("varUp"===e){t=t.split(";")[0],console.log(t),t=t.split(",");for(var o=0;o<t.length;o++){var c=t[o];c=c.split(":"),re().currentInfo.GameVar[c[0]]=re().currentInfo.GameVar[c[0]]+parseInt(c[1])}}else if("varDrop"===e){t=t.split(";")[0],console.log(t),t=t.split(",");for(var i=0;i<t.length;i++){var s=t[i];s=s.split(":"),re().currentInfo.GameVar[s[0]]=re().currentInfo.GameVar[s[0]]-parseInt(s[1])}}else if("jump_varReach"===e){t=t.split(";")[0],console.log(t);var l=(t=t.split(","))[0];l=l.split(":");var r=t[1];if(console.log("var data is"+parseInt(l[1])+re().currentInfo.GameVar[l[0]]),re().currentInfo.GameVar[l[0]]>=parseInt(l[1]))return void z(r)}else if("jump_varBelow"===e){t=t.split(";")[0],console.log(t);var u=(t=t.split(","))[0];u=u.split(":");var d=t[1];if(re().currentInfo.GameVar[u[0]]<parseInt(u[1]))return void z(d)}console.log(re().currentInfo.GameVar),M(),A()}(n,a);if("showVar"===n)console.log("showing var"),ge("command",n),ge("showName",n),ge("showText",JSON.stringify(re().currentInfo.GameVar)),D.VC_textShow(ve("showName"),ve("showText")),e=!0;else{if("if"===n.substring(0,2))return void function(e,t){var n=e.split(")")[0].split("(")[1];console.log("judgeBody is: "),console.log(n),console.log(n.split("<=")[1]);var a=!1;n.split("<=")[1]?(console.log("case <="),re().currentInfo.GameVar[n.split("<=")[0]]<=parseInt(n.split("<=")[1])&&(console.log("jump to"+t),z(t),a=!0)):n.split(">=")[1]?(console.log("case >="),re().currentInfo.GameVar[n.split(">=")[0]]>=parseInt(n.split(">=")[1])&&(console.log("jump to"+t),z(t),a=!0)):n.split("<")[1]?(console.log("case <"),re().currentInfo.GameVar[n.split("<")[0]]<parseInt(n.split("<")[1])&&(console.log("jump to"+t),z(t),a=!0)):n.split(">")[1]?(console.log("case >"),re().currentInfo.GameVar[n.split(">")[0]]>parseInt(n.split(">")[1])&&(console.log("jump to"+t),z(t),a=!0)):n.split("=")[1]&&(console.log("case = "),re().currentInfo.GameVar[n.split("=")[0]]===parseInt(n.split("=")[1])&&(console.log("jump to"+t),z(t),a=!0));a||(M(),A())}(n,a);if("setBgTransform"===n)return setTimeout((function(){D.VC_setBGtransform(a)}),100),ge("bg_transform",a),M(),void A();if("setBgFilter"===n)return setTimeout((function(){D.VC_setBGfilter(a)}),100),ge("bg_filter",a),M(),void A();if("setVar"===n)return function(e){for(var t=e.split(","),n=0;n<t.length;n++){var a=t[n],o=(a=a.split("="))[0],c=a[1];if(c.split("+")[1]){console.log("case +");var i=re().currentInfo.GameVar[c.split("+")[0]],s=parseInt(c.split("+")[1]);re().currentInfo.GameVar[o]=i+s}else if(c.split("-")[1]){console.log("case -");var l=re().currentInfo.GameVar[c.split("-")[0]],r=parseInt(c.split("-")[1]);re().currentInfo.GameVar[o]=l-r}else if(c.split("*")[1]){console.log("case *");var u=re().currentInfo.GameVar[c.split("*")[0]],d=parseInt(c.split("*")[1]);re().currentInfo.GameVar[o]=u*d}else if(c.split("/")[1]){console.log("case /");var m=re().currentInfo.GameVar[c.split("/")[0]],g=parseInt(c.split("/")[1]);re().currentInfo.GameVar[o]=m/g}else console.log("case value"),re().currentInfo.GameVar[o]=parseInt(c)}console.log(re().currentInfo.GameVar)}(a),M(),void A();if("setFigAni"===n){var s=a.split(",")[0],l=a.split(",")[1],r=a.split(",")[2];return D.VC_setAnimationByClass("figureContainer"+s,l,r),M(),void A()}if("setBgAni"===n){var u=a.split(",")[0],d=a.split(",")[1];return D.VC_setAnimationById("mainBackground",u,d),M(),void A()}"playVideo"===n?D.showVideo(a):(ge("command",S(ve("SentenceID")).name),ge("showName",S(ve("SentenceID")).name),ge("showText",S(ve("SentenceID")).text),ge("vocal",S(ve("SentenceID")).vocal),D.VC_textShow(ve("showName"),ve("showText")),""!==ve("all").vocal&&D.playVocal(),e=!0)}}if(M(),e)if(re().CurrentBacklog.length<=500){var m=JSON.stringify(ve("all"));re().CurrentBacklog[re().CurrentBacklog.length]=JSON.parse(m)}else{re().CurrentBacklog.shift();var g=JSON.stringify(ve("all"));re().CurrentBacklog[re().CurrentBacklog.length]=JSON.parse(g)}}}function v(e){if(1===re().auto&&"on"===e){setTimeout((function(){1===re().auto&&A()}),re().autoWaitTime)}}}function M(){ge("SentenceID",ve("SentenceID")+1)}function z(e){for(var t=!1,n=0,a=0;a<re().currentScene.length;a++)"label"===re().currentScene[a][0]&&re().currentScene[a][1]===e&&(t=!0,n=a);t?(ge("SentenceID",n),A()):(M(),A())}var W=n(24),R=n(12),q=n.n(R),U=n(16),F=function(){function e(){Object(s.a)(this,e),this.maxRequestBatch=6,this.minRequestInterval=3e3,this._prefetchPipeline=[],this._batchID=void 0,this._cachedAssets=new Set,this._currentCursor={scene:"",idx:0}}return Object(l.a)(e,[{key:"onSceneChange",value:function(){var e=Object(U.a)(q.a.mark((function e(t){var n,a,o,c,i,s=this,l=arguments;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:0,a=this._syncCacheInfo(),t!==this._currentCursor.scene||n!==this._currentCursor.idx){e.next=4;break}return e.abrupt("return");case 4:return this._currentCursor.scene=t,this._currentCursor.idx=n,this.signalPause(),this.flushPipeline(),e.next=10,fetch(t);case 10:if((o=e.sent).ok){e.next=13;break}throw new Error("[prefetcher] request for ".concat(t," failed with status ").concat(o.status));case 13:return e.t0=J,e.next=16,o.text();case 16:return e.t1=e.sent,e.t2={sceneUrl:t,startLine:1+n},c=(0,e.t0)(e.t1,e.t2),i=c.urgent.map((function(e){return fetch(e)})),e.next=22,a;case 22:return c.all.forEach((function(e){(s._cachedAssets.has(e)||c.urgent.includes(e))&&c.all.delete(e)})),this.flushPipeline(),this._addToPipeline(c),this.signalResume(),c.map.get("scene").forEach((function(e){return s.suggestNextScene(e)})),e.abrupt("return",Promise.allSettled(i));case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addToPipeline",value:function(e){var t;(t=this._prefetchPipeline).push.apply(t,Object(W.a)(e.all))}},{key:"suggestNextScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new URLSearchParams([["expand",!0],["start-idx",t]]).toString();this._prefetchPipeline.push("".concat(e,"?").concat(n)),this.signalResume()}},{key:"flushPipeline",value:function(){this._prefetchPipeline.length=0}},{key:"signalPause",value:function(){void 0!==this._batchID&&clearTimeout(this._batchID),this._batchID=void 0}},{key:"signalResume",value:function(){var e=this;if(void 0===this._batchID){var t=function t(n){if(n===e._batchID)if(e._prefetchPipeline.length>0)e._fetchBatch(n).catch((function(){})).then((function(){if(n===e._batchID){e._syncCacheInfo();var a=setTimeout((function(){return t(a)}),e.minRequestInterval);e._batchID=a}}));else{e._syncCacheInfo();var a=setTimeout((function(){return t(a)}),e.minRequestInterval);e._batchID=a}};this._syncCacheInfo();var n=setTimeout((function(){return t(n)}),100);this._batchID=n}}},{key:"_fetchBatch",value:function(e){for(var t=[],n=this.maxRequestBatch;n>0;){var a=this._prefetchPipeline.shift();if(void 0===a)break;this._cachedAssets.has(a)||("scene"===a.split("/",2)[1]?t.push(this._tryExpandScene(a,e)):t.push(fetch(a)),n--)}return Promise.allSettled(t)}},{key:"_tryExpandScene",value:function(e,t){var n=this,a=e.lastIndexOf("?");if(a<0)return fetch(e);var o=new URLSearchParams(e.substring(a));if(e=e.substring(0,a),o.get("expand")!=="".concat(!0))return fetch(e);var c=Number(o.get("start-idx"));return fetch(e).then((function(t){return t.ok&&t.clone().text().then((function(t){var a,o=J(t,{sceneUrl:e,startLine:1+c,urgentBudget:6,urgentOnly:!0}),i=Object(x.a)(o.urgent);try{for(i.s();!(a=i.n()).done;){var s=a.value;n._cachedAssets.has(s)||n._prefetchPipeline.includes(s)||n._prefetchPipeline.push(s)}}catch(l){i.e(l)}finally{i.f()}})),t}))}},{key:"_syncCacheInfo",value:function(){var e=Object(U.a)(q.a.mark((function e(){var t,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==window.caches){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,caches.open("webgal-cache-v1");case 5:return t=e.sent,e.next=8,t.keys();case 8:n=e.sent,this._cachedAssets=new Set(n.map((function(e){return e.url.substring(window.location.href.length)}))),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.sceneUrl,a=void 0===n?"":n,o=t.startLine,c=void 0===o?1:o,i=t.maxLine,s=void 0===i?Number.POSITIVE_INFINITY:i,l=t.urgentBudget,r=void 0===l?6:l,u=t.urgentOnly,d=void 0!==u&&u,m=new Set,g=new Map;["background","bgm","figure","scene","vocal"].forEach((function(e){g.set(e,[])}));var v,f=[],h=function(e){var t="vocal-",n=e.split(",",1)[0];return n.length<e.length&&n.length>t.length&&n.startsWith(t)?n.substring(t.length):""},j=function(e,t){var n="game/".concat(e,"/").concat(t);return!(m.has(n)||"scene"===e&&n===a)&&(m.add(n),g.get(e).push(n),r>0&&(f.push(n),r--),!0)},y=e.split("\n"),p=Object(x.a)(y.entries());try{for(p.s();!(v=p.n()).done;){var S=Object(b.a)(v.value,2),B=S[0],_=S[1];if(B+1-c>=s||d&&r<=0)break;if(!(B+1<c)){var O=_.split(";",1)[0];if(O){var k=O.split(":",1)[0];if(k.length<O.length){var I=O.substring(k.length+1);if(!I)continue;switch(k){case"changeBG":case"changeBG_next":"none"!==I&&j("background",I);break;case"changeP":case"changeP_left":case"changeP_right":case"changeP_next":case"changeP_left_next":case"changeP_right_next":case"miniAvatar":"none"!==I&&j("figure",I);break;case"changeScene":j("scene",I);break;case"choose":var N,C=I.trim().slice(1,-1).split(","),w=Object(x.a)(C);try{for(w.s();!(N=w.n()).done;){var T=N.value,E=T.split(":");2===E.length&&E[1]&&j("scene",E[1])}}catch(G){w.e(G)}finally{w.f()}break;case"bgm":j("bgm",I);break;case"intro":case"label":case"jump_label":case"choose_label":case"varSet":case"varUp":case"varDrop":case"jump_varReach":case"jump_varBelow":break;default:var L=h(I);L&&j("vocal",L)}}else{var P=h(k);P&&j("vocal",P)}}}}}catch(G){p.e(G)}finally{p.f()}return{all:m,map:g,urgent:f}}var H=new F;function Q(){H.suggestNextScene("game/scene/start.txt");var e=ve("SceneName");e&&("start.txt"!==e||ve("SentenceID"))&&H.suggestNextScene("game/scene/".concat(e),ve("SentenceID"))}window.isSecureContext?void 0!==navigator.serviceWorker?window.addEventListener("load",(function(){navigator.serviceWorker.register("webgal-sw.js").then((function(e){e.onupdatefound=function(){window.addEventListener("beforeunload",(function(){e.unregister()})),e.installing.onstatechange=function(e){"activated"===e.target.state&&(console.log("[service worker] claimed"),Q())}}})).catch((function(e){console.error("[service worker] registration failed: "+e)}))})):console.log("ServiceWorker not supported."):(console.warn("Context not secure. Requiring HTTPS to enable CacheStorage and ServiceWorker."),window.addEventListener("load",(function(){Q(),H.maxRequestBatch=6,H.minRequestInterval=5e3})));var K=n(17),Y=n.n(K),X=35,Z={Game_name:"WebGAL Demo",Game_key:"WG_default",Title_img:"Title.png",Title_bgm:"\u590f\u5f71.mp3",Loading_img:"none"},$={font_size:{small:"150%",medium:"200%",large:"250%"},play_speed:{low:55,medium:35,fast:20}},ee="",te={SceneName:"",SentenceID:0,bg_Name:"",fig_Name:"",fig_Name_left:"",fig_Name_right:"",showText:"",showName:"",command:"",choose:"",vocal:"",bgm:"",miniAvatar:"",saveTime:"",GameVar:{},bg_filter:"",bg_transform:""},ne=[],ae=[],oe=[],ce=0,ie=0,se={font_size:"medium",play_speed:"medium"},le={setAutoWaitTime:1500,autoWaitTime:1500,textShowWaitTime:X,GameInfo:Z,currentScene:ee,auto:0,fast:0,onTextPreview:0,showingText:!1,hideTextStatus:!1,currentInfo:te,Saves:ne,SaveBacklog:ae,CurrentBacklog:oe,currentSavePage:ce,currentLoadPage:ie,Settings:se,temp_bgm_TitleToGameplay:""};function re(){return le}function ue(){if(localStorage.getItem(Z.Game_key)){var e=function(e){var t=atob(e),n=t.split("").map((function(e){return e.charCodeAt(0)})),a=new Uint8Array(n),o=Y.a.inflate(a);return t=String.fromCharCode.apply(null,new Uint16Array(o)),decodeURIComponent(t)}(localStorage.getItem(Z.Game_key)),t=JSON.parse(e);ne=t.SavedGame,ae=t.SavedBacklog,ce=t.SP,ie=t.LP,se=t.cSettings}}function de(){var e={SavedGame:ne,SavedBacklog:ae,SP:ce,LP:ie,cSettings:se},t=he(JSON.stringify(e));localStorage.setItem(Z.Game_key,t)}function me(){var e=he(JSON.stringify({SavedGame:[],SavedBacklog:[],SP:0,LP:0,cSettings:{font_size:"medium",play_speed:"medium"}}));localStorage.setItem(Z.Game_key,e)}function ge(e,t){if("all"===e)for(var n in t)te.hasOwnProperty(n)&&(te[n]=t[n]);else te[e]=t}function ve(e){return"all"===e?te:te[e]}function fe(e){ee="";var t=null;t=new XMLHttpRequest,console.log("now read scene"),null!=t&&(t.open("get",e,!0),t.send(),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){ee=(ee=t.responseText).split("\n");for(var n=0;n<ee.length;n++){var a=ee[n].split(";")[0],o=a.split(":")[0].length,c=ee[n].split(":")[0];c=c.split(";")[0];var i=a.slice(o+1);ee[n]=ee[n].split(":"),ee[n][0]=c,ee[n][1]=i}console.log("Read scene complete."),console.log(ee),re().currentScene=ee,ge("SentenceID",0),A(),H.onSceneChange(e)}})}function he(e){var t=Y.a.gzip(encodeURIComponent(e),{to:"string"});return btoa(t)}var je=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"saveGame",value:function(e){console.log("saving");var t=JSON.stringify(ve("all"));ne[e]=JSON.parse(t);var n=JSON.stringify(re().CurrentBacklog);console.log(n),ae[e]=JSON.parse(n),ne[e].saveTime=(new Date).toLocaleDateString()+" "+(new Date).toLocaleTimeString("chinese",{hour12:!1}),de()}},{key:"LoadSavedGame",value:function(e){this.closeLoad(),D.VC_closeChoose(),this.hideTitle("non-restart");var t=ne[e],n="game/scene/";n+=t.SceneName,re().currentScene="";var a=null;null!=(a=new XMLHttpRequest)&&(a.open("get",n,!0),a.send(),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){re().currentScene=a.responseText,re().currentScene=re().currentScene.split("\n");for(var o=0;o<re().currentScene.length;o++){var c=re().currentScene[o].split(";")[0],i=c.split(":")[0].length,s=re().currentScene[o].split(":")[0],l=c.slice(i+1);re().currentScene[o]=re().currentScene[o].split(":"),re().currentScene[o][0]=s,re().currentScene[o][1]=l}ge("SentenceID",t.SentenceID),D.VC_restoreStatus(t),console.log(ae),re().CurrentBacklog=ae[e],console.log(oe),ge("all",t),H.onSceneChange(n,ve("SentenceID"))}})}},{key:"jumpFromBacklog",value:function(e){this.closeBacklog(),D.VC_closeChoose();for(var t=re().CurrentBacklog[e],n=re().CurrentBacklog.length-1;n>e-1;n--)re().CurrentBacklog.pop();var a="game/scene/";a+=t.SceneName,re().currentScene="";var o=null;null!=(o=new XMLHttpRequest)&&(o.open("get",a,!0),o.send(),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){re().currentScene=o.responseText,re().currentScene=re().currentScene.split("\n");for(var e=0;e<re().currentScene.length;e++){var n=re().currentScene[e].split(";")[0],c=n.split(":")[0].length,i=re().currentScene[e].split(":")[0],s=n.slice(c+1);s=s.split(";")[0],i=i.split(";")[0],re().currentScene[e]=re().currentScene[e].split(":"),re().currentScene[e][0]=i,re().currentScene[e][1]=s}ge("SentenceID",t.SentenceID),console.log("restore command sent"),console.log("restoring:"+t),D.VC_restoreStatus(t),ge("all",t),re().CurrentBacklog[re().CurrentBacklog.length]=JSON.parse(JSON.stringify(ve("all"))),H.onSceneChange(a,ve("SentenceID"))}})}},{key:"hideTitle",value:function(e){re().CurrentBacklog=[],document.getElementById("Title").style.display="none","non-restart"!==e&&(document.getElementById("chooseBox").style.display="none",ve("all").bgm="",D.loadBGM(),ve("all").fig_Name="",ve("all").fig_left="",ve("all").fig_right="",D.VC_resetStage(),fe("game/scene/start.txt"),ve("all").SceneName="start.txt",re().currentInfo.bg_Name="none",document.getElementById("mainBackground").style.backgroundImage="none")}},{key:"chooseScene",value:function(e){ve("all").SceneName=e,fe("game/scene/"+e),document.getElementById("chooseBox").style.display="none"}},{key:"chooseJumpFun",value:function(e){for(var t=e,n=!1,a=0,o=0;o<re().currentScene.length;o++)"label"===re().currentScene[o][0]&&re().currentScene[o][1]===t&&(n=!0,a=o);n?(ge("SentenceID",a),A(),document.getElementById("chooseBox").style.display="none"):(M(),A(),document.getElementById("chooseBox").style.display="none")}},{key:"clickOnBack",value:function(){re().hideTextStatus?(document.getElementById("bottomBox").style.display="flex",re().hideTextStatus=!1):A()}},{key:"onSetting",value:function(){ue(),D.VC_showSettings(),"small"===re().Settings.font_size?document.getElementById("previewDiv").style.fontSize="150%":"medium"===re().Settings.font_size?document.getElementById("previewDiv").style.fontSize="200%":"large"===re().Settings.font_size&&(document.getElementById("previewDiv").style.fontSize="250%")}},{key:"onLoadGame",value:function(){ue(),document.getElementById("Load").style.display="block",D.VC_showSave_Load("load")}},{key:"onSaveGame",value:function(){ue(),document.getElementById("Save").style.display="block",D.VC_showSave_Load("save")}},{key:"closeSettings",value:function(){document.getElementById("settings").style.display="none",document.getElementById("bottomBox").style.display="flex"}},{key:"autoNext",value:function(){0===re().auto?(re().autoWaitTime=re().setAutoWaitTime,re().textShowWaitTime=35,re().fast=0,re().auto=0,document.getElementById("autoButton").style.backgroundColor="rgba(255,255,255,0)",document.getElementById("autoButton").style.boxShadow="none",re().autoWaitTime=re().setAutoWaitTime,re().auto=1,document.getElementById("autoButton").style.backgroundColor="rgba(255,255,255,0.195)",document.getElementById("autoButton").style.boxShadow="0 0 25px rgba(255,255,255,0.5)",A()):1===re().auto&&(re().autoWaitTime=re().setAutoWaitTime,re().auto=0,document.getElementById("autoButton").style.backgroundColor="rgba(255,255,255,0)",document.getElementById("autoButton").style.boxShadow="none")}},{key:"fastNext",value:function(){0===re().fast?(re().autoWaitTime=re().setAutoWaitTime,re().auto=0,document.getElementById("autoButton").style.backgroundColor="rgba(255,255,255,0)",document.getElementById("autoButton").style.boxShadow="none",re().autoWaitTime=500,re().textShowWaitTime=5,re().fast=1,re().auto=1,document.getElementById("fastButton").style.backgroundColor="rgba(255,255,255,0.195)",document.getElementById("fastButton").style.boxShadow="0 0 25px rgba(255,255,255,0.5)",A()):1===re().fast&&(re().autoWaitTime=re().setAutoWaitTime,re().textShowWaitTime=35,re().fast=0,re().auto=0,document.getElementById("fastButton").style.backgroundColor="rgba(255,255,255,0)",document.getElementById("fastButton").style.boxShadow="none")}},{key:"closeLoad",value:function(){document.getElementById("Load").style.display="none"}},{key:"exit",value:function(){D.showMesModel("\u4f60\u786e\u5b9a\u8981\u9000\u51fa\u5417","\u9000\u51fa","\u7559\u5728\u672c\u9875",(function(){window.close()}))}},{key:"Title",value:function(){D.showMesModel("\u8981\u8fd4\u56de\u5230\u6807\u9898\u754c\u9762\u5417","\u662f","\u4e0d\u8981",(function(){document.getElementById("Title").style.display="block",re().temp_bgm_TitleToGameplay=re().currentInfo.bgm,ge("bgm",re().GameInfo.Title_bgm),D.loadBGM()}))}},{key:"continueGame",value:function(){""===re().currentScene&&(fe("game/scene/start.txt"),ve("all").SceneName="start.txt"),document.getElementById("Title").style.display="none",re().currentInfo.bgm=re().temp_bgm_TitleToGameplay,D.loadBGM()}},{key:"closeSave",value:function(){document.getElementById("Save").style.display="none"}},{key:"closeBacklog",value:function(){document.getElementById("backlog").style.display="none",document.getElementById("bottomBox").style.display="flex"}},{key:"clearIntro",value:function(){document.getElementById("intro").style.display="none",M(),A()}},{key:"hideTextBox",value:function(){re().hideTextStatus||(document.getElementById("bottomBox").style.display="none",re().hideTextStatus=!0)}},{key:"hidePanic",value:function(){document.querySelector("div#panic-overlay").style.display="none"}},{key:"showBacklog",value:function(){D.showBacklog()}},{key:"hideStartPage",value:function(){document.getElementById("WG_startPage").style.display="none",D.loadBGM(),D.VC_setAnimationById("mainBackground","bg_softIn","2s"),D.VC_setAnimationByClass("figureContainerleft","centerIn","1s"),D.VC_setAnimationByClass("figureContainercenter","centerIn","1s"),D.VC_setAnimationByClass("figureContainerright","centerIn","1s")}}]),e}();document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("selectstart",(function(e){e.preventDefault()})),document.addEventListener("mouseup",(function(e){if(2===e.button){var t=new KeyboardEvent("keyup",{key:"Delete",code:"Delete"});document.dispatchEvent(t),e.preventDefault()}})),document.addEventListener("wheel",(function(e){var t=B();_(t,"TextBox")&&t.get("TextBox")&&(e.deltaY>0?(A(),e.preventDefault()):e.deltaY<0&&(D.showBacklog(),e.preventDefault()))})),document.addEventListener("keydown",(function(e){if(!(e.isComposing||e.defaultPrevented||e.repeat))switch(e.code){case"ControlLeft":case"ControlRight":_(B(),"TextBox")&&(je.fastNext(),e.preventDefault())}})),document.addEventListener("keyup",(function(e){if(!e.isComposing&&!e.defaultPrevented)switch(e.code){case"ControlLeft":case"ControlRight":_(B(),"TextBox")&&(je.fastNext(),e.preventDefault());break;case"Space":case"Enter":case"NumpadEnter":var t=B();_(t,"TextBox")&&(t.get("TextBox")?A():(document.querySelector("div#bottomBox").style.display="flex",re().hideTextStatus=!1),e.preventDefault());break;case"KeyA":_(B(),"TextBox")&&(je.autoNext(),e.preventDefault());break;case"KeyF":_(B(),"TextBox")&&(je.fastNext(),e.preventDefault());break;case"KeyV":_(B(),"TextBox")&&(D.playVocal(),e.preventDefault());break;case"KeyS":var n=B();_(n,["TextBox","SaveScreen"])&&(n.get("SaveScreen")?je.closeSave():je.onSaveGame(),e.preventDefault());break;case"KeyL":var a=B();_(a,["TextBox","LoadScreen"])&&(a.get("LoadScreen")?je.closeLoad():je.onLoadGame(),e.preventDefault());break;case"KeyC":var o=B();_(o,["TextBox","SettingScreen"])&&(o.get("SettingScreen")?je.closeSettings():je.onSetting(),e.preventDefault());break;case"ArrowUp":_(B(),"TextBox")&&(D.showBacklog(),e.preventDefault());break;case"KeyT":var c=B();_(c,["TextBox","Title"])&&(c.get("Title")?je.continueGame():je.Title(),e.preventDefault());break;case"Delete":if(_(B(["TitleScreen","PanicScreen"]))){var i=B(["TextBox","SaveScreen","LoadScreen","SettingScreen","BacklogScreen"]);_(i,"TextBox")?i.get("TextBox")?(document.querySelector("div#bottomBox").style.display="none",re().hideTextStatus=!0):(document.querySelector("div#bottomBox").style.display="flex",re().hideTextStatus=!1):(i.get("SaveScreen")&&je.closeSave(),i.get("LoadScreen")&&je.closeLoad(),i.get("SettingScreen")&&je.closeSettings(),i.get("BacklogScreen")&&je.closeBacklog()),e.preventDefault()}break;case"Escape":B("PanicScreen")?je.hidePanic():D.showPanic("Yoozle"),e.preventDefault()}}));var ye=function(){return Object(d.jsx)("div",{id:"Title",children:Object(d.jsx)("div",{id:"TitleModel",children:Object(d.jsxs)("div",{id:"setButtonBottom",children:[Object(d.jsxs)("div",{className:"TitleSingleButton",onClick:je.hideTitle,children:[Object(d.jsx)("div",{className:"TitleButtonENG",children:"START"}),Object(d.jsx)("div",{className:"TitleButtonCHN",children:"\u4ece\u5934\u5f00\u59cb"})]}),Object(d.jsxs)("div",{className:"TitleSingleButton",onClick:je.continueGame,children:[Object(d.jsx)("div",{className:"TitleButtonENG",children:"CONTINUE"}),Object(d.jsx)("div",{className:"TitleButtonCHN",children:"\u7ee7\u7eed\u6e38\u620f"})]}),Object(d.jsxs)("div",{className:"TitleSingleButton",onClick:je.onLoadGame,children:[Object(d.jsx)("div",{className:"TitleButtonENG",children:"LOAD"}),Object(d.jsx)("div",{className:"TitleButtonCHN",children:"\u8bfb\u53d6\u6e38\u620f"})]}),Object(d.jsxs)("div",{className:"TitleSingleButton",onClick:je.onSetting,children:[Object(d.jsx)("div",{className:"TitleButtonENG",children:"CONFIG"}),Object(d.jsx)("div",{className:"TitleButtonCHN",children:"\u504f\u597d\u8bbe\u7f6e"})]}),Object(d.jsxs)("div",{className:"TitleSingleButton",onClick:je.exit,children:[Object(d.jsx)("div",{className:"TitleButtonENG",children:"EXIT"}),Object(d.jsx)("div",{className:"TitleButtonCHN",children:"\u7ed3\u675f\u6e38\u620f"})]})]})})})},pe=function(){return Object(d.jsx)("div",{id:"WG_startPage",onClick:function(){je.hideStartPage()}})},be=function(){return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{id:"intro",className:"intro_styl"}),Object(d.jsx)("div",{id:"videoContainer",className:"videoContainer_styl",onClick:D.closeVideo}),Object(d.jsx)("div",{id:"MesModel"}),Object(d.jsxs)("div",{id:"BackgroundContainer",onClick:je.clickOnBack,children:[Object(d.jsx)("div",{id:"oldBG"}),Object(d.jsx)("div",{id:"mainBackground"})]}),Object(d.jsx)("div",{id:"figureImage",className:"figureContainercenter",onClick:je.clickOnBack}),Object(d.jsx)("div",{id:"figureImage_left",className:"figureContainerleft",onClick:je.clickOnBack}),Object(d.jsx)("div",{id:"figureImage_right",className:"figureContainerright",onClick:je.clickOnBack}),Object(d.jsx)("div",{id:"chooseBox"}),Object(d.jsx)("div",{id:"bgm"}),Object(d.jsx)("div",{id:"vocal"}),Object(d.jsx)("div",{id:"panic-overlay"})]})},xe=n.p+"static/media/closeBlack.48c8b5c9.svg",Se=function(){return Object(d.jsx)("div",{id:"settings",children:Object(d.jsxs)("div",{id:"settingsMainBox",children:[Object(d.jsx)("div",{id:"close",onClick:je.closeSettings,children:Object(d.jsx)("img",{src:xe,className:"closeSVG",alt:"close"})}),Object(d.jsx)("div",{id:"settingsTitle",children:"\u8bbe\u7f6e"}),Object(d.jsx)("div",{id:"settingItems"}),Object(d.jsx)("div",{id:"textPreview"})]})})},Be=n.p+"static/media/closeWhite.a1886903.svg",_e=function(){return Object(d.jsxs)("div",{id:"backlog",children:[Object(d.jsx)("div",{id:"closeBl",onClick:je.closeBacklog,children:Object(d.jsx)("img",{src:Be,className:"closeSVG",alt:"close"})}),Object(d.jsx)("div",{id:"backlogContent"})]})},Oe=function(){return Object(d.jsx)("div",{id:"Load",className:"LS_Main",children:Object(d.jsxs)("div",{id:"loadMainBox",className:"LS_mainBox",children:[Object(d.jsx)("div",{id:"closeLoad",onClick:je.closeLoad,children:Object(d.jsx)("img",{src:Be,className:"closeSVG",id:"LoadClose",alt:"close"})}),Object(d.jsx)("div",{id:"LoadItems",className:"LS_Items"})]})})},ke=function(){return Object(d.jsx)("div",{id:"Save",className:"LS_Main",children:Object(d.jsxs)("div",{id:"saveMainBox",className:"LS_mainBox",children:[Object(d.jsx)("div",{id:"closeSave",onClick:je.closeSave,children:Object(d.jsx)("img",{src:Be,className:"closeSVG",alt:"close"})}),Object(d.jsx)("div",{id:"SaveItems",className:"LS_Items"})]})})},Ie=n.p+"static/media/cross.9d528190.svg",Ne=(n.p,n(51)),Ce=n(52),we=n(53),Te=n(54),Ee=n(55),Le=n(56),Pe=n(57),Ge=n(58),Ve=function(){var e=!1;return Object(d.jsxs)("div",{id:"controlBar",children:[Object(d.jsxs)("div",{className:"controlButton",onClick:je.showBacklog,id:"titleButton",children:[Object(d.jsx)(Ne.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:D.playVocal,children:[Object(d.jsx)(Ce.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.autoNext,id:"autoButton",children:[Object(d.jsx)(we.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.fastNext,id:"fastButton",children:[Object(d.jsx)(Te.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.onSaveGame,id:"saveButton",children:[Object(d.jsx)(Ee.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.onLoadGame,id:"loadButton",children:[Object(d.jsx)(Le.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.onSetting,children:[Object(d.jsx)(Pe.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]}),Object(d.jsxs)("div",{className:"controlButton",onClick:je.Title,id:"titleButton",children:[Object(d.jsx)(Ge.a,{theme:"outline",size:"28",fill:"#f5f5f7"}),e]})]})},De=function(){return Object(d.jsxs)("div",{id:"bottomBox",children:[Object(d.jsx)("div",{id:"top_control",children:Object(d.jsx)("span",{className:"top_button",onClick:je.hideTextBox,children:Object(d.jsx)("img",{alt:"cross",src:Ie,style:{width:"22px",height:"22px"}})})}),Object(d.jsxs)("div",{id:"mainTextWindow",onClick:A,children:[Object(d.jsx)("div",{id:"pName"}),Object(d.jsx)("div",{id:"SceneText"})]}),Object(d.jsx)(Ve,{}),Object(d.jsx)("div",{id:"miniAvatar",onClick:A})]})};var Ae=function(){return Object(d.jsxs)("div",{className:"Stage",children:[Object(d.jsx)(pe,{}),Object(d.jsx)(ye,{}),Object(d.jsx)(be,{}),Object(d.jsx)(Se,{}),Object(d.jsx)(_e,{}),Object(d.jsx)(Oe,{}),Object(d.jsx)(ke,{}),Object(d.jsx)(De,{})]})};var Me=function(){return Object(d.jsx)("div",{className:"App",children:Object(d.jsx)(Ae,{})})},ze=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,59)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),o(e),c(e),i(e)}))};n(41),n(42),n(43),n(44),n(45),n(46),n(47);i.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(Me,{})}),document.getElementById("ReactRoot")||document.createElement("div")),ze(),ue(),function(){var e=se.font_size,t=$.font_size[e],n=se.play_speed,a=$.play_speed[n];document.getElementById("SceneText").style.fontSize=t,X=a}(),function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(200===e.status){var t=e.responseText;t=t.split("\n");for(var n=0;n<t.length;n++){var a=t[n].split(";")[0].split(":");null!=a[0]&&""!==a[0]&&(Z.hasOwnProperty(a[0])?Z[a[0]]=a[1]:console.warn("[GameInfo]","'".concat(a[0],"' key in GameInfo is not exist.")))}document.getElementById("Title").style.backgroundImage='url("./game/background/'+Z.Title_img+'")',"none"!==Z.Loading_img&&(document.getElementById("WG_startPage").style.backgroundImage='url("./game/background/'+Z.Loading_img+'")'),ge("bgm",Z.Title_bgm),document.title=Z.Game_name}},e.open("GET","game/config.txt"),e.send()}(),function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"],n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}()&&(console.log("now is mobile view"),document.getElementById("bottomBox").style.height="45%",document.getElementById("ReactRoot").style.fontSize="65%",document.getElementById("mainTextWindow").style.padding="5px 20% 5px 20%",document.getElementById("SceneText").style.padding="5px 0 0 0",function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,n=document.getElementById("ReactRoot");e<t&&(n.style.width=t+"px",n.style.height=e+"px",n.style.position="relative",n.style.top=(t-e)/2+"px",n.style.left=0-(t-e)/2+"px",n.style.transform="rotate(90deg)");var a="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(a,(function(){90===window.orientation||-90===window.orientation?(n.style.width=t+"px",n.style.height=e+"px",n.style.position="relative",n.style.top="0px",n.style.left="0px",n.style.transform="none"):(n.style.width=t+"px",n.style.height=e+"px",n.style.position="relative",n.style.top=(t-e)/2+"px",n.style.left=0-(t-e)/2+"px",n.style.transform="rotate(90deg)")}),!1)}())}},[[48,1,2]]]);
//# sourceMappingURL=main.bd546abc.chunk.js.map